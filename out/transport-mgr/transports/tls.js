// Generated by CoffeeScript 1.6.3
var fs, secure, tls, _,
  __slice = [].slice;

tls = require('tls');

fs = require('fs');

_ = require('../../../vendor/lodash');

secure = require("../secure-common");

exports.bindServer = function() {
  var args, opts, pserver, si;
  args = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
  pserver = this;
  si = {};
  if (typeof args[args.length - 1] === 'object') {
    opts = args.pop();
  }
  return secure.checkCerts(opts, function(opts) {
    var cb, s;
    if (opts.rejectUnauthorized === undefined) {
      opts.rejectUnauthorized = false;
    }
    s = tls.createServer(opts, function(stream) {
      return pserver.handle(stream);
    });
    if (typeof args[args.length - 1] === 'function') {
      cb = args.pop();
    }
    args.push(function() {
      var addr;
      addr = s.address();
      pserver.setInterface({
        uri: "tls://" + addr.address + ":" + addr.port,
        unbind: function() {
          return s.close();
        }
      });
      if (cb) {
        return cb();
      }
    });
    return s.listen.apply(s, args);
  });
};

exports.bindClient = function() {
  var args, opts, pclient;
  args = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
  opts = {};
  if (typeof args[0] === 'number') {
    opts.port = args.shift();
  }
  if (typeof args[0] === 'string') {
    opts.hostname = args.shift();
  }
  if (typeof args[0] === 'object') {
    _.merge(opts, args.shift());
  }
  if (opts.rejectUnauthorized === undefined) {
    opts.rejectUnauthorized = false;
  }
  pclient = this;
  pclient.createConnection(function(callback) {
    return callback(tls.connect.call(null, opts));
  });
  pclient.setInterface({
    uri: "tls://" + (opts.hostname || 'localhost') + ":" + opts.port
  });
};

/*
//@ sourceMappingURL=tls.map
*/
